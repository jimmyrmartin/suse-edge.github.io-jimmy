<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Blog | SUSE Edge Team</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://suse-edge.github.io/img/suse-edge-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://suse-edge.github.io/img/suse-edge-social-card.jpg"><meta data-rh="true" property="og:url" content="https://suse-edge.github.io/blog"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | SUSE Edge Team"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://suse-edge.github.io/blog"><link data-rh="true" rel="alternate" href="https://suse-edge.github.io/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://suse-edge.github.io/blog" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SUSE Edge Team RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SUSE Edge Team Atom Feed"><link rel="stylesheet" href="/assets/css/styles.687d4240.css">
<link rel="preload" href="/assets/js/runtime~main.821edca9.js" as="script">
<link rel="preload" href="/assets/js/main.8673400a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/edge-logo.svg" alt="SUSE Edge Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/edge-logo.svg" alt="SUSE Edge Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SUSE Edge site</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/suse-edge/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Flexran">Deploying Intel FlexRan on the SUSE Adaptive Telco Infrastructure Platform</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/welcome">Welcome to SUSE Edge</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/Flexran">Deploying Intel FlexRan on the SUSE Adaptive Telco Infrastructure Platform</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-28T00:00:00.000Z" itemprop="datePublished">July 28, 2023</time> · <!-- -->38 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/alknopfler" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/alknopfler.png" alt="Alberto Morgante Medina"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/alknopfler" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alberto Morgante Medina</span></a></div><small class="avatar__subtitle" itemprop="description">Sr. Edge Telco Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Intel® FlexRAN is a reference implementation for a virtualized 4G and 5G RAN stack. It&#x27;s main purpose is to illustrate how to achieve real-time performance of a virtualized 4G or 5G PHY and MAC layer on an Intel-based hardware architecture, using Intel® Xeon® Scalable processors, the Intel® Advanced Vector Extensions 512 <code>Intel® AVX 512</code> instruction set and a number of other hardware acceleration features and technologies found in modern Intel Xeon family processors. While some vendors of CloudRAN and in particular O-RAN software merely use it as inspiration, some vendors adopt Intel FlexRAN directly as part of their product.
This article describes how to deploy FlexRAN on the SUSE Adaptive Telco Infrastructure Platform (ATIP) running on bare-metal infrastructure as a Containerized Network Function (CNF). In the ATIP architecture, the runtime stack consists of <a href="https://www.suse.com/products/micro/" target="_blank" rel="noopener noreferrer">SUSE Linux Enterprise Micro</a> and Rancher Kubernetes Engine v2 (RKE2) and we are using <a href="https://www.rancher.com/" target="_blank" rel="noopener noreferrer">Rancher</a> to perform cluster and application provisioning, life cycle management, application resource management and collection of telemetry data with role-based access control.
The example RAN deployment option considered here is the <a href="https://www.o-ran.org/blog/20-new-o-ran-specifications-have-been-released-since-june-2020" target="_blank" rel="noopener noreferrer">ORAN Alliance 7-2x lower-level split</a>, which in a nutshell means that the lower layer PHY processing for uplink and downlink (such as Cyclic Prefix addition/removal, iFFT/FFT, calculation of beamforming coefficients and PRACH pre-filtering) is performed in the Radio Unit (RU), and upper layer PHY processing as well as all MAC layer processing is performed in the Distributed Unit (DU). When DU and RU are deployed in different Kubernetes pods, this constitutes an excellent test for a telco cloud platform, as it requires near-realtime processing and transmission of fronthaul traffic over physical network interfaces, which is only possible with careful orchestration of a number of telco-grade platform features, as we will detail further below.</p><p>With this cloud-native setup, we can identify the appropriate configuration of the <code>Suse Edge ATIP</code> (Adaptive Telco Infrastructure Platform) stack. Also, it demostrates that telecom containerised applications like DU/CU can be run on RKE2 cluster on top of the SLE Micro RT OS taking advantage of the accelerator cards. In addition, we show that we are applying the full power and potential of the accelerator card and CPU.</p><blockquote><p>For more information about Intel FlexRan, see the official <a href="https://www.intel.com/content/www/us/en/developer/topic-technology/edge-5g/tools/flexran.html" target="_blank" rel="noopener noreferrer">Intel FlexRan website</a></p><p>For more infomration about Suse ATIP, see the official <a href="https://suse-edge.github.io/docs/product/atip/introduction" target="_blank" rel="noopener noreferrer">Suse Edge ATIP documentation</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture">​</a></h2><p>The architecture is based on the following components:</p><ul><li>Rancher Management Cluster: This component will be used to manage the lifecycle of the RKE2 clusters hosting the FlexRAN solution, as well as the monitoring platform based on the Rancher monitoring stack (Grafana and Prometheus installed on the downstream cluster). This cluster is based on a single-node RKE2 cluster on top of SLE Micro.</li><li>Edge Cluster 1: This cluster will be used to deploy the <code>FlexRan Timer Mode tests</code>. This cluster is based on a single-node RKE2 cluster on top of SLE Micro RT Operating System.</li><li>Edge Cluster 2: This cluster will be used to deploy the <code>FlexRan Xran Mode tests</code>. This cluster is based on a single-node RKE2 cluster on top of SLE Micro RT Operating System.</li></ul><blockquote><p>Note: The FlexRan tests could be deployed on the same edge cluster, but just for clarity and simplicity in the article, we will deploy them on different clusters.</p></blockquote><p><img loading="lazy" alt="img.png" src="/assets/images/architecture-components-6da738ff8243400b53fa1440e05c94c0.png" width="1525" height="1116" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hardware-and-software-components">Hardware and Software components<a href="#hardware-and-software-components" class="hash-link" aria-label="Direct link to Hardware and Software components" title="Direct link to Hardware and Software components">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hardware">Hardware<a href="#hardware" class="hash-link" aria-label="Direct link to Hardware" title="Direct link to Hardware">​</a></h3><p>The hardware used for this article is based on the following components:</p><ul><li>Dell PowerEdge XR11 servers</li><li>Intel XEON Gold 6338N 2.2G</li><li>8 x 32GB RDIMM 3200MT/S</li><li>2 x 480GB SSD SATA Disk</li><li>Intel E810-CQDA2 Dual Port 100GbE QSFP28</li><li>ACC100 FEC Accelerator card</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="software">Software<a href="#software" class="hash-link" aria-label="Direct link to Software" title="Direct link to Software">​</a></h3><p>The software used for this article is based on the following components:</p><ul><li>Operating system: <code>SLE Micro 5.4</code></li><li>Kernel Real Time: <code>5.14.21-150400.15.11-rt</code> </li><li>RKE2 version: <code>v1.25.9+rke2r1</code></li><li>CNI plugins: <code>Multus 0.3.1</code> and  <code>Calico v3.25.0</code></li><li>Rancher release: <code>rancher-stable v2.7.5</code></li><li>Dpdk version: <code>22.11</code></li><li>SRIOV upstream <code>v3.5.1</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flexran">Flexran<a href="#flexran" class="hash-link" aria-label="Direct link to Flexran" title="Direct link to Flexran">​</a></h3><p>The FlexRan deployment used for this article is based on the following components:</p><ul><li>FlexRAN version: <code>22.07</code> using <a href="https://hub.docker.com/r/intel/flexran_vdu" target="_blank" rel="noopener noreferrer">pre-defined containers</a> from Intel.</li><li>Intel OneAPI Base Toolkit: <code>2022.1.2.146</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-management-cluster">Rancher Management Cluster<a href="#rancher-management-cluster" class="hash-link" aria-label="Direct link to Rancher Management Cluster" title="Direct link to Rancher Management Cluster">​</a></h2><p>In our case, the Rancher management cluster will be used to manage the lifecycle of the RKE2 edge clusters deployed for the FlexRAN solution, as well as the monitoring platform based on Grafana and Prometheus.</p><p><img loading="lazy" alt="img.png" src="/assets/images/mgmt-component-58c05bd0acbb4b5d73bff46fc72eac01.png" width="449" height="351" class="img_ev3q"></p><blockquote><p>The operating system installation steps have been omitted for the sake of brevity. There are no special performance-related configuration settings required for the OS on the management cluster.
For more information about how to install the Operating System, see the next <a href="https://suse-edge.github.io/docs/product/atip/management-cluster" target="_blank" rel="noopener noreferrer">link</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rke2-cluster-installation-on-the-management-server">RKE2 Cluster Installation on the Management Server<a href="#rke2-cluster-installation-on-the-management-server" class="hash-link" aria-label="Direct link to RKE2 Cluster Installation on the Management Server" title="Direct link to RKE2 Cluster Installation on the Management Server">​</a></h3><p>Once you have the Operating System installed, you can proceed with the Rancher installation. First, we will install a RKE2 cluster and then, the Rancher Helm chart to install the Rancher management cluster.</p><ol><li>Run the RKE2 installer:</li></ol><p><code>curl -sfL https://get.rke2.io | sh -</code></p><p>if you want to install a particular version, the <code>INSTALL_RKE2_VERSION</code> variable can be used as:</p><p><code>curl -sfL https://get.rke2.io | INSTALL_RKE2_VERSION=&quot;v1.25.9+rke2r1&quot; sh -</code></p><blockquote><p>For more information about the installation, please refer to the documentation: <a href="https://docs.rke2.io/install/install_options/" target="_blank" rel="noopener noreferrer">https://docs.rke2.io/install/install_options/</a></p></blockquote><ol start="2"><li>Enable and start the rke2-server service:</li></ol><p><code>systemctl enable --now rke2-server.service</code></p><p>In case you want to run the RKE2 agent (in case you need to add more nodes designated to run your apps and services), you can follow the next steps:</p><ol><li>Run the RKE2 installer:</li></ol><p><code>curl -sfL https://get.rke2.io | INSTALL_RKE2_TYPE=&quot;agent&quot; sh -</code></p><ol start="2"><li>Configure the config.yaml file located in <code>/etc/rancher/rke2/</code> with the following content:</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//&lt;server</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9345</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;token from server node</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Enable and start the service:</li></ol><p><code>systemctl enable --now rke2-agent.service</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-manager-install">Rancher Manager Install<a href="#rancher-manager-install" class="hash-link" aria-label="Direct link to Rancher Manager Install" title="Direct link to Rancher Manager Install">​</a></h3><p>Rancher is installed using the Helm package manager for Kubernetes.
Helm charts provide templating syntax for Kubernetes YAML manifest documents. With Helm, we can create configurable deployments instead of just using static files.</p><blockquote><p>This section covers the deployment of Rancher on the management cluster.</p><p>For more information about the Rancher manager installation, please refer to the documentation: <a href="https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster" target="_blank" rel="noopener noreferrer">https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster</a></p></blockquote><ol><li>Add the Helm repository</li></ol><p>There are three Rancher manager releases available to be added as a Helm repository for Rancher. In our case, we will use the <code>rancher-stable</code> because it&#x27;s the release recommended for production environments, but you could use <code>rancher-latest</code> or <code>rancher-alpha</code> if you want. Also, there is a <code>rancher primer</code> release that is the enterprise version of Rancher.</p><p><code>helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</code></p><blockquote><p>If you don&#x27;t have <code>helm</code> installed previously, you could install it using the following command:</p><p><code>curl -fsSL https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 |bash</code></p></blockquote><ol start="2"><li>Choose your SSL Configuration</li></ol><p>The Rancher management server is designed to be secure by default and requires SSL/TLS configuration.</p><p>There are three recommended options for SSL/TLS configuration:</p><ul><li>Rancher-generated TLS certificate</li><li>Let&#x27;s Encrypt</li><li>Bring your own certificate</li></ul><blockquote><p>For more information about the SSL/TLS configuration, please refer to the documentation: <a href="https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster/#3-choose-your-ssl-configuration" target="_blank" rel="noopener noreferrer">https://ranchermanager.docs.rancher.com/v2.7/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster/#3-choose-your-ssl-configuration</a></p></blockquote><p>In our case we will use the Rancher-generated TLS certificate. This requires <code>cert-manager</code> to be deployed in the cluster as::</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> jetstack https://charts.jetstack.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> cert-manager jetstack/cert-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --namespace cert-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --set </span><span class="token assign-left variable" style="color:#36acaa">installCRDs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --version v1.11.1 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once you&#x27;ve installed cert-manager, you can verify the pods are running:
<code>kubectl get pods --namespace cert-manager</code></p><ol start="3"><li>Install Rancher with Helm using the following command modifying the <code>&lt;hostname&gt;</code> and <code>&lt;bootstrapPassword&gt;</code> values to fit your environment:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> rancher rancher-stable/rancher </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --namespace cattle-system </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --set </span><span class="token assign-left variable" style="color:#36acaa">hostname</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hostname</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --set </span><span class="token assign-left variable" style="color:#36acaa">bootstrapPassword</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">bootstrapPassword</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --set </span><span class="token assign-left variable" style="color:#36acaa">replicas</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --set global.cattle.psp.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Verify the Rancher installation</li></ol><p>You should wait a few minutes for Rancher to be rolled out:</p><p><code>kubectl -n cattle-system rollout status deploy/rancher</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="edge-cluster-deployment">Edge Cluster deployment<a href="#edge-cluster-deployment" class="hash-link" aria-label="Direct link to Edge Cluster deployment" title="Direct link to Edge Cluster deployment">​</a></h2><p>This section covers the bare-metal provisioning and installation of the edge cluster nodes in order to deploy the FlexRan tests. In our case, we will deploy two edge clusters, one for the FlexRan Timer Mode tests and another one for the FlexRan Xran Mode tests.
The configuration of the edge cluster nodes is based on the following components, and it will be the same for the two edge clusters:</p><p><img loading="lazy" alt="img.png" src="/assets/images/edge-06988c351b0dc0022d4cadfb3f3f9345.png" width="472" height="1031" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bios-configuration-for-dell-poweredge-xr11">BIOS Configuration for Dell PowerEdge XR11<a href="#bios-configuration-for-dell-poweredge-xr11" class="hash-link" aria-label="Direct link to BIOS Configuration for Dell PowerEdge XR11" title="Direct link to BIOS Configuration for Dell PowerEdge XR11">​</a></h3><p>The BIOS and NIC configuration used for this article based on the <a href="/blog/Flexran#hardware">hardware</a> shown above, could be imported directly using the <a target="_blank" href="/assets/files/system-config-cc951c914ab7ef2227ff55e08e2b9f2b.xml">Dell PowerEdge XR11 BIOS Exported Configuration File</a>.
In order to import the configuration file, you need to do it using the idrac web interface:</p><p><img loading="lazy" alt="img.png" src="/assets/images/import-bios-dc8ab5db57feda5794f47efb142ab95c.png" width="1912" height="635" class="img_ev3q"></p><blockquote><p><em>Note</em>: This configuration depends on the hardware vendor, so please, check with your hardware vendor the best configuration to be used.</p></blockquote><p>Pay special attention to the parameters suggested here as some of them could dramatically increase or decrease the performance of the tests being executed.
The next table shows the recommended configuration as a reference for the most common hardware vendors:</p><table><thead><tr><th>Option</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Workload Profile</td><td>Telco Optimized</td><td>Telco profile to optimize the performance in the hardware.</td></tr><tr><td>Boot Performance Mode</td><td>Max. Performance</td><td>Maximize the performance in the boot process.</td></tr><tr><td>Hyper- Threading (Logical Proccesor)</td><td>Enable</td><td>This option enables Intel® Hyper-Threading Technology for logical processor enabling and converting processor cores (pCores) to logical cores (lCores).</td></tr><tr><td>Virtualization Technology (XAPIC)</td><td>Enable</td><td>This option is for Extended Advanced Programmable Interrupt Controller (xAPIC) support for the Intel® Virtualization Technology for Directed I/O (Intel® VT-d) feature.</td></tr><tr><td>uncore frequency scaling</td><td>Disable</td><td>If enabled, Uncore Frequency Scaling (UFS) allows the uncore to operate at a lower frequency when the Power Control Unit (PCU) has detected low utilization. Conversely, UFS allows the uncore to operate at a higher frequency when the PCU has detected high utilization.</td></tr><tr><td>CPU P-State Control (EIST PSD Function</td><td>HW_ALL</td><td>optimization of the voltage and CPU fequency during operation</td></tr><tr><td>CPU C-State Control</td><td>Disable</td><td>This option is for the CPU C-State Control feature, which provides power savings by placing the processor into lower power states when the processor is idle.</td></tr><tr><td>CPU C1E Support</td><td>Disable</td><td>This option is for the CPU Enhanced Halt (C1E) feature, which provides power savings by placing the processor into a low power state when the processor is idle.</td></tr><tr><td>AVX License Pre-Grant</td><td>Enable</td><td>If enabled, this option enables the pre-grant license level selection based on workload with the AVX ICCP Pre-Grant Level option.</td></tr><tr><td>AVX ICCP Pre- Grant Level</td><td>Level 5</td><td>This option selects a workload level for the Intel® Advanced Vector Extensions (Intel® AVX): Intel® AVX-512 Heavy</td></tr><tr><td>AVX P1</td><td>Level 2</td><td>This option serves a dual purpose: 1 -Specifies the base P1 ratio for Intel® Streaming SIMD Extensions (Intel® SSE) or Intel® AVX workloads. 2- Pre-grants a license level based on the workload level.</td></tr><tr><td>Energy Efficient Turbo</td><td>Disable</td><td>This option allows entry into the Intel® Turbo Boost Technology frequency when the Power Control Unit (PCU) has detected high utilization.</td></tr><tr><td>Turbo Mode</td><td>Enable</td><td>Enabling this Intel® Turbo Boost Technology mode setting allows the CPU cores to operate at higher than the rated frequency.</td></tr><tr><td>GPSS timer</td><td>0us</td><td>This option allows the reduction of the Global P-State Selection (GPSS) timer to be set from: 0 μs to 500 μs</td></tr><tr><td>LLC prefetch</td><td>Enable</td><td>This option enables Last Level Cache (LLC) hardware prefetch logic.</td></tr><tr><td>Frequency Prioritization (RAPL Prioritization)</td><td>Disable</td><td>This setting controls whether the Running Average Power Limit (RAPL) balancer is enabled. If enabled, it activates per core power budgeting.</td></tr><tr><td>Hardware P-States</td><td>Native with no Legacy Support</td><td>When enabled, this option allows the hardware to choose a Performance State (P-State) based on an OS request (that is, a legacy P-State).</td></tr><tr><td>EPP enable3</td><td>Disable</td><td>When this option is enabled, the system uses the energy performance bias register for the Energy Performance Preference (EPP) input to make decision on Performance State (P-State) or Processor Core Idle State (C-State) transitions.</td></tr><tr><td>APS Rocketing</td><td>Disable</td><td>Rocketing mechanism in the HWP p-state selection for pcode algorithm. Rocketing enables the core ratio to jump to max turbo instantaneously as opposed to a smooth ramp</td></tr><tr><td>Scalability</td><td>Disable</td><td>Core Performance to frequency scalability based on optimizations in the CPU.</td></tr><tr><td>Native ASPM</td><td>Disable</td><td>ASPM off not controlled by BIOS or OS.</td></tr><tr><td>Power Performance Tuning</td><td>OS Controls EPB</td><td>This option selects the BIOS or OS that controls the Energy Performance Bias (EPB) functionality.</td></tr><tr><td>Workload Configuration</td><td>I/O sensitive</td><td>This option allows the system power and performance profile to be set to favor compute intensive workload or I/O sensitive workload.</td></tr><tr><td>Dynamic L1</td><td>Disable</td><td>This option applies only to the package-level setting to allow dynamically entering the lower power link state L1.</td></tr><tr><td>Set Fan Profile</td><td>Performance</td><td>This option allows the fan profile to be set to Performance, Balanced, or Quiet.</td></tr><tr><td>Cooling Configuration - Fan Speed Offset</td><td>Medium</td><td>This option allows the fan speed offset to be set to Low, Medium, or High.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="os-installation">OS Installation<a href="#os-installation" class="hash-link" aria-label="Direct link to OS Installation" title="Direct link to OS Installation">​</a></h3><p>For this example, we will assume the SLE Micro RT 5.4 operating system has been already installed on the baremetal host used to deploy the edge clusters. To verify the <code>Real Time Kernel</code> version used, you can use the following command (pay attention to the <code>-rt</code> suffix):</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">uname</span><span class="token plain"> -r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5.14</span><span class="token plain">.21-150400.15.11-rt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>If you want to download the SLE Micro RT 5.4 ISO, you can use the following link paying special attention to the <code>-RT</code> in the image name, once you&#x27;ve logged in with your SUSE credentials: <a href="https://www.suse.com/download/sle-micro/" target="_blank" rel="noopener noreferrer">Download SLE Micro RT from Suse Customer Center</a></p></blockquote><blockquote><p>For more information about how to install the operating system SLE Micro RT, see the next <a href="https://suse-edge.github.io/docs/product/atip/management-cluster#os-install" target="_blank" rel="noopener noreferrer">link</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="os-configuration-and-tuning">OS Configuration and Tuning<a href="#os-configuration-and-tuning" class="hash-link" aria-label="Direct link to OS Configuration and Tuning" title="Direct link to OS Configuration and Tuning">​</a></h3><p>Once you have the Operating System installed, you can proceed with the Operating System configuration. For this article, we will configure the Operating System using the next steps:</p><ol><li>CPU Tuned Configuration</li></ol><p>The first thing is to create a profile for the CPU cores we want to isolate. In this case, we will isolate the cores 1-30 and 33-62 to be used by FlexRan, keeping also some cores available for the system.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;export tuned_params&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/grub.d/00_tuned</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;isolated_cores=1-30,33-62&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/tuned/cpu-partitioning-variables.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> tuned</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> systemctl start tuned</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tuned-adm profile cpu-partitioning</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Grub Configuration</li></ol><p>We need to modify some grub options to be able to do the CPU isolation as well as another important parameters for the CPU performance on this scenario.</p><p>The following options have to be customized:</p><table><thead><tr><th>parameter</th><th>value</th><th>description</th></tr></thead><tbody><tr><td>isolcpu</td><td>1-30,33-62</td><td>Isolate the cores 1-30 and 33-62</td></tr><tr><td>skew_tick</td><td>1</td><td>Allows the kernel to skew the timer interrupts across the isolated CPUs.</td></tr><tr><td>nohz</td><td>on</td><td>Allows the kernel to run the timer tick on a single CPU when the system is idle.</td></tr><tr><td>nohz_full</td><td>1-30,33-62</td><td>kernel boot parameter is the current main interface to configure full dynticks along with CPU Isolation.</td></tr><tr><td>rcu_nocbs</td><td>1-30,33-62</td><td>Allows the kernel to run the RCU callbacks on a single CPU when the system is idle.</td></tr><tr><td>kthread_cpus</td><td>0,31,32,63</td><td>Allows the kernel to run the kthreads on a single CPU when the system is idle.</td></tr><tr><td>irqaffinity</td><td>0,31,32,63</td><td>Allows the kernel to run the interrupts on a single CPU when the system is idle.</td></tr><tr><td>processor.max_cstate</td><td>1</td><td>Prevents the CPU from dropping into a sleep state when idle</td></tr><tr><td>intel_idle.max_cstate</td><td>0</td><td>Disables the intel_idle driver and allows acpi_idle to be used</td></tr><tr><td>iommu</td><td>pt</td><td>Allows to use vfio for the dpdk interfaces</td></tr><tr><td>intel_iommu</td><td>on</td><td>Enables to use vfio for VFs.</td></tr><tr><td>hugepagesz</td><td>1G</td><td>Allows to set the size of huge pages to 1G</td></tr><tr><td>hugepages</td><td>40</td><td>Number of hugepages defined before</td></tr><tr><td>default_hugepagesz</td><td>1G</td><td>Default value to enable huge pages</td></tr></tbody></table><blockquote><p>For mor information about theses parameters, please refer to the next <a href="https://suse-edge.github.io/docs/product/atip/features" target="_blank" rel="noopener noreferrer">link</a></p></blockquote><p>With the values showed above, we are isolating 60 cores, and we are using 4 cores for the OS.</p><p>We can modify the grub config as follows:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">GRUB_CMDLINE_LINUX</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;intel_iommu=on intel_pstate=passive processor.max_cstate=1 intel_idle.max_cstate=0 iommu=pt usbcore.autosuspend=-1 selinux=0 enforcing=0 nmi_watchdog=0 crashkernel=auto softlockup_panic=0 audit=0 mce=off hugepagesz=1G hugepages=40 hugepagesz=2M hugepages=0 default_hugepagesz=1G kthread_cpus=0,31,32,63 irqaffinity=0,31,32,63 isolcpu=1-30,33-62 skew_tick=1 nohz_full=1-30,33-62 rcu_nocbs=1-30,33-62 rcu_nocb_poll&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transactional-update grub.cfg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To validate that the parameters are applied after reboot, you could check:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/cmdline</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Compile the DPDK drivers</li></ol><p>In order to use the <code>igb_uio</code> driver, which is necessary for the ACC100 acceleration card, we need to compile the DPDK drivers for the SLE Micro RT kernel.
The process to build the <code>igb_uio</code> driver will be explained in this section, but if you don&#x27;t want to deal with the compilation, you can also download the compiled driver for <code>SLE Micro RT 5.4</code> rpm files from <a target="_blank" href="/assets/files/dependencies.tar-6670dd24286eab1ff44ae4f2ecc1d518.gz">here</a>.</p><p>To do that, we will use an auxiliary virtual machine (only to compile and generate the rpm files) with <code>SLE-RT 15 SP4 kernel</code> that you can download from <a href="https://www.suse.com/download/sle-rt/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Once you have available your virtual machine with the SLE 15 SP4 installed you need to verify <code>-rt</code> in the kernel to ensure we will compile for a real time kernel.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">uname</span><span class="token plain"> -r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5.14</span><span class="token plain">.21-150400.15.53-rt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first thing you have to do to compile the driver is to download the <code>dpdk</code> source code from the <a href="http://dpdk.org/git/dpdk-kmods" target="_blank" rel="noopener noreferrer">DPDK repository</a>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone http://dpdk.org/git/dpdk-kmods</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once you have the source code, you can compile the driver using the following commands:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> dpdk-kmods/igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> -C /lib/modules/</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">uname</span><span class="token variable" style="color:#36acaa"> -r</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">/build </span><span class="token assign-left variable" style="color:#36acaa">M</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> modules</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With this command you will get the <code>igb_uio.ko</code> driver compiled. But in our case, we will create a rpm package to be able to install it in the SLE Micro RT kernel.</p><ul><li>First create an x509.genkey setup to define the type of key we need:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> -e </span><span class="token string" style="color:#e3116c">&quot;[ req ] </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">default_bits = 4096 </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">distinguished_name = req_distinguished_name </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">prompt = no </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">x509_extensions = myexts </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ req_distinguished_name ] </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">CN = Modules </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ myexts ] </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">basicConstraints=critical,CA:FALSE </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">keyUsage=digitalSignature </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">subjectKeyIdentifier=hash </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">authorityKeyIdentifier=keyid&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> x509.genkey</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Then create the certificates based on these:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -new -nodes -utf8 -sha512 -days </span><span class="token number" style="color:#36acaa">36500</span><span class="token plain"> -batch -x509 -config x509.genkey -outform DER -out signing_key.x509 -keyout signing_key.priv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Note: The signing key instruction are only used for testing, please create &quot;proper&quot; certificates for production usage.</p></blockquote><ul><li>Install <code>build</code>, <code>kernel-rt</code> and <code>kernel-devel-rt</code>  to create the rpm package:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">zypper</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> build kernel-rt kernel-devel-rt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Modify the config file to adapt it for the RT kernel:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /usr/lib/build/configs/sle15.4.conf /usr/lib/build/configs/sle15.4-rt.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -e </span><span class="token string" style="color:#e3116c">&#x27;s/kernel-default/kernel-rt/g&#x27;</span><span class="token plain"> -i /usr/lib/build/configs/sle15.4-rt.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Prefer: wicked&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /usr/lib/build/configs/sle15.4-rt.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Prepare the spec file:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;&gt;</span><span class="token string bash punctuation" style="color:#393A34"> igb_uio.spec</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># spec file for package igb_uio kmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Copyright (c) 2023 SUSE LINUX GmbH, Nuernberg, Germany.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># All modifications and additions to the file contributed by third parties</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># remain the property of their copyright owners, unless otherwise agreed</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># upon. The license for this file, and modifications and additions to the</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># file, is the same license as for the pristine package itself (unless the</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># license for the pristine package is not an Open Source License, in which</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># case the license is the MIT License). An &quot;Open Source License&quot; is a</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># license that conforms to the Open Source Definition (Version 1.9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># published by the Open Source Initiative.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Please submit bugfixes or comments via http://bugs.opensuse.org/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># norootforbuild</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Name:               igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Version:                1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Release:                0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Summary:                Kernel Module Package for igb_uio module</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">License:                GPL-2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Group:              System/Kernel</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">URL:                    https://www.suse.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#Git-Clone:     http://dpdk.org/git/dpdk-kmods</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Source0:                %{name}-%{version}.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Required to sign modules:  Include certificate named “signing_key.x509”</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Build structure should also include a private key named “signing_key.priv”</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Private key should not be listed as a source file</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Source1:        signing_key.x509</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">BuildRequires:  %kernel_module_package_buildreqs</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">BuildRequires:  kernel-rt</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">BuildRequires:  kernel-rt-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#BuildRequires:  bash-sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#BuildRequires:  libelf-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#BuildRequires:  systemd</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#BuildRequires:  pam-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#BuildRequires:  libffi7</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#BuildRequires:  ghc-bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">BuildRoot:      %{_tmppath}/%{name}-%{version}-build</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Required to sign modules:  The -c option tells the macro to generate a</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># suse-hello-ueficert subpackage that enrolls the certificate</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">%suse_kernel_module_package -c %_sourcedir/signing_key.x509</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">%description</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">This package contains the igb_uio.ko module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">%prep</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">%setup</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Required to sign modules:  Copy the signing key to the build area</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">cp %_sourcedir/signing_key.* .</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set -- *</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">mkdir source</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">mv &quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot; source/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">mkdir obj</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">%build</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">for flavor in %flavors_to_build; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       rm -rf obj/</span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       cp -r source obj/</span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       make -C %{kernel_source </span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c">} modules M=</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/obj/</span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">%install</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">export INSTALL_MOD_PATH=</span><span class="token string variable" style="color:#36acaa">$RPM_BUILD_ROOT</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">export INSTALL_MOD_DIR=updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">for flavor in %flavors_to_build; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       make -C %{kernel_source </span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c">} modules_install M=</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/obj/</span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       # Required to sign modules:  Invoke kernel-sign-file to sign each module</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       for x in </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">find</span><span class="token string variable" style="color:#36acaa"> $INSTALL_MOD_PATH/lib/modules/*-$flavor/ -name </span><span class="token string variable string" style="color:#e3116c">&#x27;*.ko&#x27;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">               /usr/lib/rpm/pesign/kernel-sign-file -i pkcs7 sha256 </span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/obj/</span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c">/signing_key.priv </span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/obj/</span><span class="token string variable" style="color:#36acaa">$flavor</span><span class="token string" style="color:#e3116c">/signing_key.x509 </span><span class="token string variable" style="color:#36acaa">$x</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       done</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">%changelog</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">* Fri Jun 9 2023 Rhys Oxenham &lt;rhys.oxenham@suse.com&gt; - 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">- Initial spec file as base</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;&gt;</span><span class="token string bash punctuation" style="color:#393A34"> Kbuild</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ccflags-y := </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">MODULE_CFLAGS</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">obj-m := igb_uio.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create the rpm packages:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">build --dist /usr/lib/build/configs/sle15.4-rt.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>After creating the rpm files, the packages will be located here: <code>/var/tmp/build-root/home/abuild/rpmbuild/RPMS/x86_64</code></li></ul><ol start="4"><li>Install the dependencies.</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">transactional-update shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/zypp/repos.d/flexran-dependencies.repo </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[home_amorgante_branches_home_dpitchumani]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name=Branch project for package DPDK-22.11 (15.4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">type=rpm-md</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">baseurl=https://download.opensuse.org/repositories/home:/amorgante:/branches:/home:/dpitchumani/15.4/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgkey=https://download.opensuse.org/repositories/home:/amorgante:/branches:/home:/dpitchumani/15.4/repodata/repomd.xml.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[home_amorgante]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name=home:amorgante (15.4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">type=rpm-md</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">baseurl=https://download.opensuse.org/repositories/home:/amorgante/15.4/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgkey=https://download.opensuse.org/repositories/home:/amorgante/15.4/repodata/repomd.xml.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, we can install the dependencies (*.rpm files) with the igb_uio driver compiled previously (or downloaded from <a target="_blank" href="/assets/files/dependencies.tar-6670dd24286eab1ff44ae4f2ecc1d518.gz">here</a>):</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suseconnect -p PackageHub/15.4/x86_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">zypper</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> *.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">zypper</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> dpdk dpdk-tools pf-bb-config pciutils </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>CPU Performance</li></ol><p>Further improve the deterministic and power efficiency:</p><p><code>cpupower frequency-set -g performance</code></p><p>Set cpu core frequency to 2.6Ghz which is the maximum allowed in our case (based on the hardware):</p><p><code>cpupower frequency-set -u 2500000</code></p><p><code>cpupower frequency-set -d 2500000</code></p><p>Set cpu uncore to fixed – maximum allowed. Disable c6 and c1e in order to disable the powersaving features in your system (only if enabled):</p><p><code>cpupower idle-set -d 3</code></p><p><code>cpupower idle-set -d 2</code></p><blockquote><p>In case you&#x27;ve got the following message <code>Idlestate 3 not available on CPU x</code> you can ignore it, because that&#x27;s means that the idle state is already disabled.</p></blockquote><ol start="6"><li>Check the CPU performance</li></ol><p>You should see the driver intel_cpufreq and the governor performance with a frequency range between 2.5 and 2.6Ghz:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cpupower frequency-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">analyzing CPU </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  driver: intel_cpufreq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CPUs </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> run at the same hardware frequency: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CPUs </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> need to have their frequency coordinated by software: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maximum transition latency: </span><span class="token number" style="color:#36acaa">20.0</span><span class="token plain"> us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hardware limits: </span><span class="token number" style="color:#36acaa">800</span><span class="token plain"> MHz - </span><span class="token number" style="color:#36acaa">3.50</span><span class="token plain"> GHz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  available cpufreq governors: ondemand performance schedutil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  current policy: frequency should be within </span><span class="token number" style="color:#36acaa">800</span><span class="token plain"> MHz and </span><span class="token number" style="color:#36acaa">3.50</span><span class="token plain"> GHz.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  The governor </span><span class="token string" style="color:#e3116c">&quot;performance&quot;</span><span class="token plain"> may decide </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> speed to use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  within this range.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  current CPU frequency: Unable to call hardware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  current CPU frequency: </span><span class="token number" style="color:#36acaa">2.60</span><span class="token plain"> GHz </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">asserted by call to kernel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  boost state support:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Supported: </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Active: </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rke2-cluster-installation">RKE2 Cluster Installation<a href="#rke2-cluster-installation" class="hash-link" aria-label="Direct link to RKE2 Cluster Installation" title="Direct link to RKE2 Cluster Installation">​</a></h3><p>The RKE2 installation could be done creating a new cluster from the Rancher UI or importing an existing RKE2 cluster to Rancher.
In our case, for brevity we will install a new RKE2 Cluster from scratch importing it after that directly into Rancher.</p><blockquote><p>If you want to install the RKE2 cluster from the Rancher UI you can follow <a href="https://suse-edge.github.io/docs/product/atip/edge-site#edge-site-definition" target="_blank" rel="noopener noreferrer">this document</a></p></blockquote><ol><li>Run the RKE2 installer:</li></ol><p>In this scenario we use the <code>v1.25.9+rke2r1</code> version as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -sfL https://get.rke2.io | INSTALL_RKE2_VERSION=&quot;v1.25.9+rke2r1&quot; sh -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Create the <code>/etc/rancher/rke2/config.yaml</code> file (and the rancher/rke2 directory) with the following content to enable <code>Multus + Calico</code> CNI plugins:</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">cni</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> multus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> calico</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Start rke2-server service:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> --now rke2-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Check the installation</li></ol><p>Make sure the calico and multus pods are running:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE         NAME                                                    READY   STATUS      RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calico-system     calico-kube-controllers-687bc88ddf-6dp4r                </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m13s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calico-system     calico-node-jkhx9                                       </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m13s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calico-system     calico-typha-869bd9756d-ft4bs                           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m13s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       cloud-controller-manager-xr11-2                         </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m49s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       etcd-xr11-2                                             </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m47s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-calico-crd-q2cp2                      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-calico-nv4rn                          </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-coredns-55k9x                         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-ingress-nginx-fvmp4                   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-metrics-server-d2dhz                  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-multus-mm59z                          </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-snapshot-controller-crd-vbcjb         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-snapshot-controller-jw6pk             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       helm-install-rke2-snapshot-validation-webhook-w5sj2     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       kube-apiserver-xr11-2                                   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m53s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       kube-controller-manager-xr11-2                          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m51s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       kube-proxy-xr11-2                                       </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m48s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       kube-scheduler-xr11-2                                   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m51s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       rke2-coredns-rke2-coredns-6b9548f79f-bc54n              </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m26s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       rke2-coredns-rke2-coredns-autoscaler-57647bc7cf-bfggl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m26s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       rke2-ingress-nginx-controller-6vsgf                     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m18s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       rke2-metrics-server-7d58bbc9c6-qjkvr                    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m33s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       rke2-multus-ds-4zsqr                                    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m26s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       rke2-snapshot-controller-7b5b4f946c-rhtxn               </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m32s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       rke2-snapshot-validation-webhook-7748dbf6ff-cfmpm       </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tigera-operator   tigera-operator-7bd6b54cb8-2jm92                        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3m23s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="acc100-configuration">ACC100 Configuration<a href="#acc100-configuration" class="hash-link" aria-label="Direct link to ACC100 Configuration" title="Direct link to ACC100 Configuration">​</a></h3><p>The ACC100 accelerator card is a PCIe card that provides hardware acceleration for the Forward Error Correction (FEC) algorithm. This card is used by the FlexRan library to improve the performance of the DU/CU components.</p><ol><li>Load the <code>igb_uio</code> kernel module</li></ol><blockquote><p>During the OS configuration section we have installed the <code>igb</code> driver, <code>dpdk</code> as well as the <code>pf-bb-config</code> tool <a href="#os-configuration-and-tunning">requirements</a></p></blockquote><p>We will start configuring the Accelerator Card by loading the <code>ibg_uio</code> and the <code>vfio-pci</code> module.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">modprobe igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modprobe vfio-pci</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Get the interface ACC100 PCI address:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/sbin/lspci </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -i acc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8a:00.0 Processing accelerators: Intel Corporation Device 0d5c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Bind the Physical Function (PF) with the <code>igb_uio</code> driver:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dpdk-devbind.py -b igb_uio 0000:8a:00.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Create 2 Virtual Functions (vfs) from the PF and bind them with <code>vfio-pci</code> driver:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/bus/pci/devices/0000:8a:00.0/max_vfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dpdk-devbind.py -b vfio-pci 0000:8b:00.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>Configure acc100 using the <code>pf-bb-config</code> tool:
The Physical Function (PF) Baseband Device (BBDEV) Configuration Application (<code>pf_bb_config</code>) provides a means to configure a baseband device at the host level. The program accesses the configuration space and sets various parameters through memory-mapped I/O (MMIO) reads and writes.
The parameters are parsed from a given configuration file (with .cfg extensions) that is specific to a particular baseband device, although they follow same format.</li></ol><blockquote><p>For more information about the pf-bb-config tool, please refer to the <a href="https://github.com/intel/pf-bb-config" target="_blank" rel="noopener noreferrer">documentation</a></p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pf_bb_config ACC100 -c /opt/pf-bb-config/acc100_config_vf_5g.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue Jun  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:49:20 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">:INFO:Queue Groups: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> 5GUL, </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> 5GDL, </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> 4GUL, </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> 4GDL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue Jun  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:49:20 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">:INFO:Configuration </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> VF mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue Jun  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:49:21 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">:INFO: ROM version MM 99AD92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue Jun  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:49:21 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">:WARN:* Note: Not on DDR PRQ version  </span><span class="token number" style="color:#36acaa">1302020</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10092020</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue Jun  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:49:21 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">:INFO:PF ACC100 configuration complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue Jun  </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:49:21 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">:INFO:ACC100 PF </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0000:8a:00.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> configuration complete</span><span class="token operator" style="color:#393A34">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Check the new VFs created are available and ready to be used by the FlexRan library:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dpdk-devbind.py -s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Baseband devices using DPDK-compatible driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:8a:00.0 </span><span class="token string" style="color:#e3116c">&#x27;Device 0d5c&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:8b:00.0 </span><span class="token string" style="color:#e3116c">&#x27;Device 0d5d&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Other Baseband devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:8b:00.1 </span><span class="token string" style="color:#e3116c">&#x27;Device 0d5d&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dpdk-configuration">DPDK Configuration<a href="#dpdk-configuration" class="hash-link" aria-label="Direct link to DPDK Configuration" title="Direct link to DPDK Configuration">​</a></h3><p>The Data Plane Development Kit (DPDK) is a set of data plane libraries and network interface controller drivers for fast packet processing. It is designed to run on any processors. In our case, we will use the DPDK libraries to accelerate the performance of the FlexRan library.
Let&#x27;s start to create some VFs to be available for the FlexRan workloads:</p><ol><li>Create the VF PCI addresses in the node:</li></ol><p>In this section we will create 4 VFs for each PF (2 PFs in total for the dual port E810 100G interface) binding to the vfio driver, and then, we will assign a MAC address to each VF.
The MAC address is used by the FlexRan library to identify the VFs. This is not a mandatory step, but then, you will need to modify the FlexRan Docker entrypoint script in order to adapt the MAC addresses to the VFs created. We will talk more about the docker entrypoint script in the next section.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/bus/pci/devices/0000:51:00.0/sriov_numvfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p1 vf </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> mac 00:11:22:33:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p1 vf </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> mac 00:11:22:33:00:10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p1 vf </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> mac 00:11:22:33:00:20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p1 vf </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> mac 00:11:22:33:00:30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /sys/bus/pci/devices/0000:51:00.1/sriov_numvfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p2 vf </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> mac 00:11:22:33:00:01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p2 vf </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> mac 00:11:22:33:00:11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p2 vf </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> mac 00:11:22:33:00:21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> p2p2 vf </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> mac 00:11:22:33:00:31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dpdk-devbind.py -b vfio-pci 0000:51:01.0 0000:51:01.1 0000:51:01.2 0000:51:01.3 0000:51:11.0 0000:51:11.1 0000:51:11.2 0000:51:11.3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Review the configuration:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dpdk-devbind.py -s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Network devices using DPDK-compatible driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:01.0 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:01.1 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:01.2 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:01.3 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:01.0 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:11.1 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:21.2 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:31.3 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Adaptive Virtual Function 1889&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iavf,igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Network devices using kernel driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:19:00.0 </span><span class="token string" style="color:#e3116c">&#x27;BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">em1 </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bnxt_en </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci *Active*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:19:00.1 </span><span class="token string" style="color:#e3116c">&#x27;BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">em2 </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bnxt_en </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:19:00.2 </span><span class="token string" style="color:#e3116c">&#x27;BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">em3 </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bnxt_en </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:19:00.3 </span><span class="token string" style="color:#e3116c">&#x27;BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">em4 </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bnxt_en </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:00.0 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Controller E810-C for QSFP 1592&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eth13 </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ice </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:51:00.1 </span><span class="token string" style="color:#e3116c">&#x27;Ethernet Controller E810-C for QSFP 1592&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rename8 </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ice </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Baseband devices using DPDK-compatible driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:8a:00.0 </span><span class="token string" style="color:#e3116c">&#x27;Device 0d5c&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:8b:00.0 </span><span class="token string" style="color:#e3116c">&#x27;Device 0d5d&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">drv</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vfio-pci </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Other Baseband devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000:8b:00.1 </span><span class="token string" style="color:#e3116c">&#x27;Device 0d5d&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">unused</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">igb_uio,vfio-pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sriov-configuration">SRIOV Configuration<a href="#sriov-configuration" class="hash-link" aria-label="Direct link to SRIOV Configuration" title="Direct link to SRIOV Configuration">​</a></h3><p>The Single Root I/O Virtualization <code>SR-IOV</code> is a specification that allows a PCIe device to appear to be multiple separate physical PCIe devices.
The SR-IOV network device plugin is Kubernetes device plugin for discovering and advertising networking resources such as:</p><ul><li>SR-IOV virtual functions <code>VFs</code></li><li>PCI physical functions <code>PFs</code></li><li>Auxiliary network devices, in particular Subfunctions <code>SFs</code></li></ul><p>To deploy workloads with SR-IOV VF, Auxiliary network devices or PCI PF, this plugin needs to work together with the following two CNI components:</p><ul><li>Any CNI meta plugin supporting Device Plugin based network provisioning. In our case will be <code>Multus</code></li><li>A CNI capable of consuming the network device allocated to the Pod</li></ul><blockquote><p>For more information about the SR-IOV CNI, please refer to the <a href="https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin/tree/master" target="_blank" rel="noopener noreferrer">documentation</a></p></blockquote><ol><li>Prepare the config map for the device plugin:</li></ol><p>You could get the information to fill the config map from the <code>lspci</code> command. In our case we will have the next 3 types of devices:</p><ul><li><p>FEC acceleartor card VF: <code>0d5d</code>.
This is the first VF created on the ACC100 card and should match with the first VF created on the previous section.</p></li><li><p>ODU interface: <code>1889</code>, <code>8086</code> and <code>p2p1</code> as a filter.
This is the first port of the E810 interface and should match with the 4 first VFs created on the previous section.</p></li><li><p>ORU interface: <code>1889</code>, <code>8086</code> and <code>p2p2</code> as a filter.
This is the second port of the E810 interface and should match with the 4 last VFs created on the previous section.</p></li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> k apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriovdp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">config.json</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;resourceList&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &quot;resourceName&quot;: &quot;intel_fec_5g&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &quot;devicetype&quot;: &quot;accelerator&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &quot;selectors&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;vendors&quot;: [&quot;8086&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;devices&quot;: [&quot;0d5d&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &quot;resourceName&quot;: &quot;intel_sriov_odu&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &quot;selectors&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;vendors&quot;: [&quot;8086&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;devices&quot;: [&quot;1889&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;drivers&quot;: [&quot;vfio-pci&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;pfNames&quot;: [&quot;p2p1&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &quot;resourceName&quot;: &quot;intel_sriov_oru&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &quot;selectors&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;vendors&quot;: [&quot;8086&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;devices&quot;: [&quot;1889&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;drivers&quot;: [&quot;vfio-pci&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &quot;pfNames&quot;: [&quot;p2p2&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Prepare the daemonset for the device plugin</li></ol><p>No changes are needed in the daemonset, so you can use the same upstream daemonset as is for the FlexRAN deployment.</p><blockquote><p>For more information about the daemonset, please refer to the <a href="https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin/blob/master/deployments/sriovdp-daemonset.yaml" target="_blank" rel="noopener noreferrer">documentation</a></p></blockquote><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> k apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DaemonSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sriov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriovdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">tier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriovdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hostNetwork</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/arch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">role.kubernetes.io/master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">serviceAccountName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sriovdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ghcr.io/k8snetworkplumbingwg/sriov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">network</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dir=sriovdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">level=10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;250m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;40Mi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;200Mi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> devicesock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/lib/kubelet/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/pcidp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/k8s.cni.cncf.io/devinfo/dp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> devicesock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/lib/kubelet/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/k8s.cni.cncf.io/devinfo/dp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DirectoryOrCreate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">configMap</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sriovdp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">items</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After deploying the daemonset on the RKE2 edge cluster, you should see the pods running:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -n kube-system </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> sriov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system       kube-sriov-device-plugin-amd64-twjfl                    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Check the interfaces discovered and available in the node for the FlexRan workload:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get nodes -oname</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> -o </span><span class="token assign-left variable" style="color:#36acaa">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{.status.allocatable}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;cpu&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;64&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;ephemeral-storage&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;256196109726&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;hugepages-1Gi&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;40Gi&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;hugepages-2Mi&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;intel.com/intel_fec_5g&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;intel.com/intel_sriov_odu&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;intel.com/intel_sriov_oru&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;memory&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;221396384Ki&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;pods&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;110&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you can see in the output above, we have 2 types of resources available for the FlexRan workload:</p><ul><li><p>The FEC will be <code>intel.com/intel_fec_5g</code> and the value will be 1 because we bind just only 1 of 2.</p></li><li><p>The VFs will be <code>intel.com/intel_sriov_odu</code> or <code>intel.com/intel_sriov_oru</code> and the value will be 4 because we bind 4 VFs for each PF. </p></li></ul><p>Basically, FlexRan will request some resources available in the host to be used as a VF for the tests we&#x27;re going to run.</p><blockquote><p>Important Note: If you don&#x27;t get the resources available here, does not make sense continue with the flexran demo tests. Please, review the previous steps to ensure you have the VFs created and the SRIOV CNI plugin working properly.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="flexran-tests">FlexRan tests<a href="#flexran-tests" class="hash-link" aria-label="Direct link to FlexRan tests" title="Direct link to FlexRan tests">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h3><p>For this article, we will use the next references to deploy the Intel FlexRan reference implementation on top of the ATIP edge cluster:</p><ul><li>We will use the pre-defined containers from Intel: <a href="https://hub.docker.com/r/intel/flexran_vdu" target="_blank" rel="noopener noreferrer">FlexRan pre-defined containers</a></li><li>You will also need to download the FlexRan-22.07 tarball from Intel to run the tests and mount the downloaded <code>tests</code> folder into the pre-defined containers because it&#x27;s not included into the pre-defined containers. <blockquote><p>In order to download those files, it is required to have access to the Intel website (you can ask your Intel representative). </p><ul><li>FlexRAN-22.07-L1.tar.gz_part00</li><li>FlexRAN-22.07-L1.tar.gz_part01</li></ul></blockquote></li><li>Container Entrypoint script (Just in case you need to change anything else like the MAC addresses for the VFs)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-the-files-downloaded-from-intel">Prepare the files downloaded from Intel<a href="#prepare-the-files-downloaded-from-intel" class="hash-link" aria-label="Direct link to Prepare the files downloaded from Intel" title="Direct link to Prepare the files downloaded from Intel">​</a></h3><p>Once you have the tarball files downloaded from Intel, you can join the files and extract the content:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> FlexRAN-22.07-L1.tar.gz_part* flexran</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flexran</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> FlexRAN-22.07-L1.tar.gz_part* </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -xzvf -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, we need to execute the <code>extract.sh</code> script to get the <code>tests</code> folder available to be mounted into the containers. Also, we will copy the docker entrypoint script to be modified if needed.</p><blockquote><p>During this process manual intervention is required to accept the license agreement</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./extract.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /home/tmp_flexran</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -R tests/ /home/tmp_flexran/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain">  build/docker/docker_entry.sh /home/tmp_flexran/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The `/home/tmp_flexran will be the folder to be mounted into the containers on the next section.</p><p>Before deploying the FlexRan containers, let&#x27;s review the next steps:</p><ul><li>Interfaces to be used in the flexran pods yaml files, should be referenced by their resource names. You could get those as: <code>kubectl get nodes -o json | jq &#x27;.items[].status.allocatable&#x27;</code> as explained in the previous <a href="#sriov-configuration">section</a></li><li>The container entrypoint script contains the tests files customization for this specific environment. It will modify some parameters such as MAC addresses, <code>VF</code> information and the <code>dpdk</code> info into the <code>tests</code>. It will be explained in the next section.</li><li>Tests should be mounted in <code>/home/tmp_flexran/tests</code> and exposed in <code>/home/flexran/tests</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-entrypoint">Container entrypoint<a href="#container-entrypoint" class="hash-link" aria-label="Direct link to Container entrypoint" title="Direct link to Container entrypoint">​</a></h3><p>The FlexRan containers run a script when the container is started.
The script will modify the configuration files of the FlexRan tests applications to adapt the tests to our environment.</p><p>The modifications done in this file will be:</p><ul><li><p><code>PCIDEVICE_INTEL_COM_INTEL_FEC_5G=$(env|grep PCIDEVICE_INTEL_COM_INTEL_FEC_5G= |awk -F &#x27;=&#x27; &#x27;{print $2}&#x27;)</code>  in order to select the right PCI device for the FEC ACC100 card used for the 5G acceleration.</p></li><li><p><code>export INTEL_COM_INTEL_CPULIST=$(cat /sys/fs/cgroup/cpuset/cpuset.cpus)</code> to get the CPU list of the host machine.</p></li></ul><p>Also, we need to change the CPU cores as well as the MAC addresses into the RU section because there isn&#x27;t any substitution in the entrypoint script. We need to change the next lines:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/ioCore=2/ioCore=62/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/duMac0=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/duMac0=00:11:22:33:00:00/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/duMac1=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/duMac1=00:11:22:33:00:10/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/ruMac0=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/ruMac0=00:11:22:33:00:01/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/ruMac1=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/ruMac1=00:11:22:33:00:11/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/duMac2=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/duMac2=00:11:22:33:00:20/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/duMac3=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/duMac3=00:11:22:33:00:30/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/ruMac2=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/ruMac2=00:11:22:33:00:21/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;s/ruMac3=[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]:[0-9,a-z][0-9,a-z]/ruMac3=00:11:22:33:00:31/g&quot;</span><span class="token plain"> config_file_o_ru.dat</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, we need to remove (or comment with the hashtag <code>#</code> sign) the tests not covered by the flexran container version we are using (the test files are not present in the FlexRan tests suite used so the script will fail):</p><ul><li>flexran/bin/nr5g/gnb/l1/orancfg/sub3_mu0_20mhz_sub3_mu1_20mhz_4x4/gnb/</li><li>flexran/bin/nr5g/gnb/l1/orancfg/sub3_mu0_20mhz_sub6_mu1_100mhz_4x4/gnb/</li><li>flexran/bin/nr5g/gnb/l1/orancfg/mmwave_mu3_100mhz_2x2/gnb/</li><li>flexran/bin/nr5g/gnb/l1/orancfg/mmwave_mu3_100mhz_2x2/gnb/</li><li>flexran/bin/nr5g/gnb/l1/orancfg/sub3_mu0_20mhz_sub3_mu1_20mhz_4x4/oru/</li><li>flexran/bin/nr5g/gnb/l1/orancfg/sub3_mu0_20mhz_sub6_mu1_100mhz_4x4/oru/</li><li>flexran/bin/nr5g/gnb/l1/orancfg/mmwave_mu3_100mhz_2x2/oru/</li></ul><p>For instance, you will have the next block commented (or removed):</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#cd /home/flexran/bin/nr5g/gnb/l1/orancfg/sub3_mu0_20mhz_sub3_mu1_20mhz_4x4/gnb/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sed -i &quot;s/&lt;systemThread&gt;2, 0, 0&lt;\/systemThread&gt;/&lt;systemThread&gt;$systemthread, 0, 0&lt;\/systemThread&gt;/g&quot; phycfg_xran.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sed -i &quot;s/&lt;timerThread&gt;0, 96, 0&lt;\/timerThread&gt;/&lt;timerThread&gt;$timerThread, 96, 0&lt;\/timerThread&gt;/g&quot; phycfg_xran.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sed -i &quot;s/&lt;FpgaDriverCpuInfo&gt;3, 96, 0&lt;\/FpgaDriverCpuInfo&gt;/&lt;FpgaDriverCpuInfo&gt;$FpgaDriverCpuInfo, 96, 0&lt;\/FpgaDriverCpuInfo&gt;/g&quot; phycfg_xran.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sed -i &quot;s/&lt;FrontHaulCpuInfo&gt;3, 96, 0&lt;\/FrontHaulCpuInfo&gt;/&lt;FrontHaulCpuInfo&gt;$FrontHaulCpuInfo, 96, 0&lt;\/FrontHaulCpuInfo&gt;/g&quot; phycfg_xran.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#sed -i &quot;s/&lt;radioDpdkMaster&gt;2, 99, 0&lt;\/radioDpdkMaster&gt;/&lt;radioDpdkMaster&gt;$radioDpdkMaster, 99, 0&lt;\/radioDpdkMaster&gt;/g&quot; phycfg_xran.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>An example of docker entrypoint script is available <a target="_blank" href="/assets/files/flexran-dockerentrypoint-770e638dbcb42ca500952a2c633ffef6.sh">here</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flexran-timer-mode">FlexRan Timer Mode<a href="#flexran-timer-mode" class="hash-link" aria-label="Direct link to FlexRan Timer Mode" title="Direct link to FlexRan Timer Mode">​</a></h3><p>FlexRAN Timer Mode use case does not use fronthaul. RF IQ samples are read from files and write to files. The test pod is configured with two containers. One container is for <code>L1APP</code>, and another one is for <code>TestMAC</code>.
Smaller storage is built in pod as Kubernetes resources, but the storage is not enough for the test case. The test case requires 20GB storage for tests files, so it will be mounted from the host using the <code>tests</code> volume mount path.
The test case is a setup for one peak cell and two average cells. 8 cores with HT enabled are pinned for <code>L1APP</code>, the average core utilization is between 45-65%. The below figure shows the threading model for this test case.</p><p><img loading="lazy" alt="img.png" src="/assets/images/timer3-354caf268444b9625389c617ceff6996.png" width="829" height="508" class="img_ev3q"></p><p>To deploy the Test Timer Mode, we will use the next yaml file:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> kubectl apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dockerimage_release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dockerimage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">capabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> IPC_LOCK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> SYS_NICE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot; cp flexran/build/docker/docker_entry.sh .; sh docker_entry.sh -m timer ; cd /home/flexran/bin/nr5g/gnb/l1/; ./l1.sh -e ; top&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">stdin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LD_LIBRARY_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /opt/oneapi/lib/intel64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> intel/flexran_vdu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v22.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">l1app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;32Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_fec_5g</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;32Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_fec_5g</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hugepage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /hugepages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> varrun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/dpdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /home/flexran/tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">capabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> IPC_LOCK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> SYS_NICE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sleep 10; sh docker_entry.sh -m timer ; cd /home/flexran/bin/nr5g/gnb/testmac/; ./l2.sh --testfile=icelake-sp/icxsp.cfg; top&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">stdin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LD_LIBRARY_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /opt/oneapi/lib/intel64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> intel/flexran_vdu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v22.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">testmac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;12Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 8Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;12Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 8Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hugepage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /hugepages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> varrun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/dpdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /home/flexran/tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hugepage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">medium</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HugePages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> varrun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/home/tmp_flexran/tests&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /proc    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The next resources are required:</p><ul><li><code>intel.com/intel_fec_5g: &#x27;1&#x27;</code> to request the FEC ACC100 resource.</li><li><code>hugepages-1Gi: 16Gi</code> to request the hugepages resource for the first container.</li><li><code>hugepages-1Gi: 8Gi</code> to request the hugepages resource for the second container.</li><li><code>/home/tmp_flexran/tests</code> folder mounted to <code>/home/flexran/tests</code> in order to have the tests available for the containers.</li><li><code>image: intel/flexran_vdu:v22.07</code> to use the pre-defined container from Intel pre-defined containers.</li></ul><p>Once the pod is deployed, you can check the status of the pod:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flexran-dockerimage-release   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will launch automatically the Timer Mode Tests which contains 83 tests for the FlexRan library. It could take up to 3 hours to complete the tests. The status of the tests can be found in the container logs:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs flexran-dockerimage-release flexran-l1app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After a successful tests execution the following output should be shown:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">All Tests Completed, Total run </span><span class="token number" style="color:#36acaa">83</span><span class="token plain"> Tests, PASS </span><span class="token number" style="color:#36acaa">83</span><span class="token plain"> Tests, and FAIL </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mem_mgr_display_size:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Num Memory Alloc:               </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Total Memory Size:         </span><span class="token number" style="color:#36acaa">264,018</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using <code>htop</code> we could see the CPU usage of the containers as well as the pinned cores for this workload:</p><p><img loading="lazy" alt="img_1.png" src="/assets/images/clitimer-d26bc93c94a3cfb22169d70c2ab4dc7c.png" width="1736" height="980" class="img_ev3q"></p><p>Using the Rancher UI, you can check the status of the pods and the logs of the containers.
Also, you could get the next metrics using prometheus and grafana to check the CPU usage , CPU cores isolated used, and the Memory usage of the containers:</p><p><img loading="lazy" alt="img_6.png" src="/assets/images/graftimer-42e13bd519d9a0b4a3b53a86e839d425.png" width="1915" height="895" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flexran-xran-mode">FlexRan Xran Mode<a href="#flexran-xran-mode" class="hash-link" aria-label="Direct link to FlexRan Xran Mode" title="Direct link to FlexRan Xran Mode">​</a></h3><p>FlexRAN XRAN Mode uses two Intel® Ethernet 100G 2P E810 Adapter on the two PCIe x16 slots. The two NIC cards are connected by fiber directly for fronthaul eCPRI C-Plane and U-Plane traffic.
SR-IOV is enabled on the two E810 NIC cards. ACC100 accelerator cards and RF IQ samples over Ethernet VFs use SR-IOV resources. The O-DU test pod is configured with two containers. One container is for <code>L1APP</code>, and another one is for <code>TestMAC</code>. The O-RU test pod is configured with one container.
Smaller storage is built in pod as Kubernetes resources, but the larger storage is mapped from the host.
The test case is a setup for six average cells with O-RAN lower layer split option 7-2x. 2 cores with HT enabled are pinned for <code>L1APP</code>, the average core utilization is 65%. 2 cores are pinned for O-RU fronthaul, 2 cores are pinned for L1 fronthaul. The below figure shows the threading model for this test case.</p><p><img loading="lazy" alt="img.png" src="/assets/images/xran1-a7fde60e2ae5cb2cf65eebd8282584f4.png" width="834" height="518" class="img_ev3q"></p><p>To deploy the XRAN Mode, we will use the next yaml file:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> kubectl apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vdu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vdu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vdu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vdu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">capabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> IPC_LOCK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> SYS_NICE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cp flexran/build/docker/docker_entry.sh . ; sh docker_entry.sh -m xran ; top&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">stdin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LD_LIBRARY_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /opt/oneapi/lib/intel64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> intel/flexran_vdu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v22.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vdu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;24Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_fec_5g</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_sriov_odu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;24Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_fec_5g</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_sriov_odu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hugepage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /hugepages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> varrun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/dpdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /home/flexran/tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hugepage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">medium</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HugePages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> varrun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/home/tmp_flexran/tests&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">capabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> IPC_LOCK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> SYS_NICE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;cp flexran/build/docker/docker_entry.sh . ; sh docker_entry.sh -m xran ; top&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">stdin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LD_LIBRARY_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /opt/oneapi/lib/intel64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> intel/flexran_vdu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v22.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flexran</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">oru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;24Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_sriov_oru</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;24Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">hugepages-1Gi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">intel.com/intel_sriov_oru</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hugepage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /hugepages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> varrun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/run/dpdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /home/flexran/tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hugepage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">medium</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HugePages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> varrun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/home/tmp_flexran/tests&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /proc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The next resources are required:</p><ul><li><code>intel.com/intel_fec_5g: &#x27;1&#x27;</code> to request the FEC ACC100 resource.</li><li><code>intel.com/intel_sriov_odu: &#x27;4&#x27;</code> to request the 4 VFs for the ODU interface.</li><li><code>intel.com/intel_sriov_oru: &#x27;4&#x27;</code> to request the 4 VFs for the ORU interface.</li><li><code>hugepages-1Gi: 20Gi</code> to request the hugepages resource for the first container.</li><li><code>hugepages-1Gi: 16Gi</code> to request the hugepages resource for the second container.</li><li><code>/home/tmp_flexran/tests</code> folder mounted to <code>/home/flexran/tests</code> in order to have the tests available for the containers.</li></ul><p>Once the pods are deployed, you need to launch the tests manually. You can do that using the next commands:</p><ol><li>Open a terminal in the <code>flexran-vdu</code> pod and run the following commands:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -ti flexran-vdu-66c9bf5765-ftptg /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flexran/bin/nr5g/gnb/l1/orancfg/sub6_mu1_100mhz_4x4/gnb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./l1.sh -oru</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Open a new terminal in the <code>flexran-vdu</code> pod and run the following commands:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -ti flexran-vdu-66c9bf5765-ftptg /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flexran/bin/nr5g/gnb/testmac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./l2.sh --testfile</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/l1/orancfg/sub6_mu1_100mhz_4x4/gnb/testmac_clxsp_mu1_100mhz_hton_oru.cfg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Open a third terminal to run the <code>flexran-vru</code> pod and run the following commands:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -ti flexran-vru-66casd2e5765-23resd /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> flexran/bin/nr5g/gnb/l1/orancfg/sub6_mu1_100mhz_4x4/oru/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x run_o_ru.sh</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> taskset -c </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> ./run_o_ru.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using <code>htop</code> we could see the CPU usage of the containers as well as the pinned cores for this workload:</p><p><img loading="lazy" alt="img_2.png" src="/assets/images/xran2-0ce802ee2c7d5c6b4321ef4fa513df48.png" width="1649" height="957" class="img_ev3q"></p><p>Using the Rancher UI, you can check the status of the pods and the logs of the containers.
Also, you could get the next metrics using prometheus and grafana to check the CPU usage , CPU cores isolated used, and the Memory usage of the containers:</p><p><img loading="lazy" alt="img_3.png" src="/assets/images/xran3-5ee9949853787eba22afd5b0741beba4.png" width="1843" height="895" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Building, testing, and deploying a properly configured Intel® FlexRAN implementation can show the benefits of VNFs and vRAN with Intel® Xeon® Scalable Processors and Intel® Advanced Vector Extensions.
SUSE provides all the components for an open-source, enterprise-grade, software-defined stack for cloud-native orchestration and management. SUSE Linux Enterprise Micro Real Time, Rancher Kubernetes Engine v2 (RKE2) and Rancher Management were used and illustrated as key ingredients to simplify the deployment of Intel® FlexRAN.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/edge">edge</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/telco">telco</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/flexran">flexran</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/welcome">Welcome to SUSE Edge</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-05-28T00:00:00.000Z" itemprop="datePublished">May 28, 2023</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/jimmyrmartin" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/jimmyrmartin.png" alt="Jimmy Martin"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/jimmyrmartin" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jimmy Martin</span></a></div><small class="avatar__subtitle" itemprop="description">Field Product Manager</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Thank you for visiting our SUSE Engineering Page.</p><p>There are many things we aim to accomplish with this website.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/edge">edge</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/team">team</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/announcement">announcement</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">SUSE Edge</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/suse-edge" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 SUSE Edge team. All Rights Reserved. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.821edca9.js"></script>
<script src="/assets/js/main.8673400a.js"></script>
</body>
</html>